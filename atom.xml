<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[kk Blog —— 通用基础]]></title>
  <link href="http://abcdxyzk.github.io/atom.xml" rel="self"/>
  <link href="http://abcdxyzk.github.io/"/>
  <updated>2024-09-14T10:54:15+08:00</updated>
  <id>http://abcdxyzk.github.io/</id>
  <author>
    <name><![CDATA[kk]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[钉钉开放平台API]]></title>
    <link href="http://abcdxyzk.github.io/blog/2024/09/14/lang-web-ding/"/>
    <updated>2024-09-14T10:41:00+08:00</updated>
    <id>http://abcdxyzk.github.io/blog/2024/09/14/lang-web-ding</id>
    <content type="html"><![CDATA[<p><a href="https://open.dingtalk.com/document/orgapp/chatbots-send-one-on-one-chat-messages-in-batches">https://open.dingtalk.com/document/orgapp/chatbots-send-one-on-one-chat-messages-in-batches</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public $corpId = 'XXX';
</span><span class='line'>public $AppID = 'XXX';
</span><span class='line'>public $AgentId = 'XXX';
</span><span class='line'>public $ClientID = 'XXX';
</span><span class='line'>public $ClientSecret = 'XXX';
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>function index($startpage = 0)
</span><span class='line'>{
</span><span class='line'>&#9;echo "111&lt;br&gt;";
</span><span class='line'>&#9;echo "&lt;div id='cc'&gt;333&lt;/div&gt;";
</span><span class='line'>&#9;echo "&lt;div id='dd'&gt;333&lt;/div&gt;";
</span><span class='line'>&#9;echo '&lt;script src="https://g.alicdn.com/dingding/dingtalk-jsapi/3.0.25/dingtalk.open.js"&gt;&lt;/script&gt;';
</span><span class='line'>&#9;echo "&lt;script&gt; dd.getAuthCode({ corpId: 'XXX',  success: (res) =&gt; { document.getElementById('cc').innerHTML = res.code; }, }); document.getElementById('dd').innerHTML = 'ff'; &lt;/script&gt;";
</span><span class='line'>&#9;// echo "&lt;script&gt; dd.replacePage({ url: 'http://www.baidu.com' }); /* dd.closePage(); */ &lt;/script&gt;";
</span><span class='line'>
</span><span class='line'>&#9;// 根据 code access_token 获取免密用户信息
</span><span class='line'>&#9;// curl -X POST -d "code=XXX" "https://oapi.dingtalk.com/topapi/v2/user/getuserinfo?access_token=XXX"
</span><span class='line'>
</span><span class='line'>&#9;echo "222&lt;br&gt;";
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>function auth($startpage = 0)
</span><span class='line'>{
</span><span class='line'>&#9;echo "555&lt;br&gt;";
</span><span class='line'>&#9;echo "&lt;div id='cc'&gt;444&lt;/div&gt;";
</span><span class='line'>&#9;echo "&lt;div id='dd'&gt;444&lt;/div&gt;";
</span><span class='line'>&#9;echo '&lt;script src="https://g.alicdn.com/dingding/dingtalk-jsapi/3.0.25/dingtalk.open.js"&gt;&lt;/script&gt;';
</span><span class='line'>&#9;//echo "&lt;script&gt; dd.getAuthCode({ corpId: 'XXX',  success: (res) =&gt; { document.getElementById('cc').innerHTML = res.code; }, }); document.getElementById('dd').innerHTML = 'ff'; &lt;/script&gt;";
</span><span class='line'>&#9;// echo "&lt;script&gt; dd.replacePage({ url: 'http://www.baidu.com' }); /* dd.closePage(); */ &lt;/script&gt;";
</span><span class='line'>&#9;echo "&lt;script&gt; dd.getAuthCode({ corpId: 'XXX',  success: (res) =&gt; { dd.openLink({url: 'https://www.baidu.com' }); dd.closePage(); }, }); document.getElementById('dd').innerHTML = 'ff'; &lt;/script&gt;";
</span><span class='line'>
</span><span class='line'>&#9;// 根据 code access_token 获取免密用户信息
</span><span class='line'>&#9;// curl -X POST -d "code=XXX" "https://oapi.dingtalk.com/topapi/v2/user/getuserinfo?access_token=XXX"
</span><span class='line'>
</span><span class='line'>&#9;echo "666&lt;br&gt;";
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>function auth2($startpage = 0)
</span><span class='line'>{
</span><span class='line'>&#9;echo "555&lt;br&gt;";
</span><span class='line'>&#9;echo "&lt;div id='cc'&gt;444&lt;/div&gt;";
</span><span class='line'>&#9;echo "&lt;div id='dd'&gt;444&lt;/div&gt;";
</span><span class='line'>&#9;echo '&lt;script src="https://g.alicdn.com/dingding/dingtalk-jsapi/3.0.25/dingtalk.open.js"&gt;&lt;/script&gt;';
</span><span class='line'>
</span><span class='line'>&#9;$url = "http://n.com/rs/ding/auth2";
</span><span class='line'>&#9;$nonceStr = 'kk';
</span><span class='line'>&#9;$agentId = $this-&gt;AgentId;
</span><span class='line'>&#9;$timeStamp = time() * 1000;
</span><span class='line'>&#9;$corpId = $this-&gt;corpId;
</span><span class='line'>
</span><span class='line'>&#9;$jsticket = 'XXX';
</span><span class='line'>
</span><span class='line'>&#9;$plain = "jsapi_ticket=" . $jsticket . "&noncestr=" . $nonceStr . "&timestamp=" . $timeStamp . "&url=" . $url;
</span><span class='line'>&#9;echo $plain;
</span><span class='line'>
</span><span class='line'>&#9;// TODO
</span><span class='line'>&#9;$sign = sha1($plain);
</span><span class='line'>&#9;var_dump($sign);
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&#9;//echo "&lt;script&gt; dd.getAuthCode({ corpId: 'XXX',  success: (res) =&gt; { document.getElementById('cc').innerHTML = res.code; }, }); document.getElementById('dd').innerHTML = 'ff'; &lt;/script&gt;";
</span><span class='line'>&#9;// echo "&lt;script&gt; dd.replacePage({ url: 'http://www.baidu.com' }); /* dd.closePage(); */ &lt;/script&gt;";
</span><span class='line'>&#9;echo "&lt;script&gt; dd.getAuthCode({ corpId: 'XXX',  success: (res) =&gt; { dd.openLink({url: 'https://www.baidu.com' }); dd.closePage(); }, }); document.getElementById('dd').innerHTML = 'ff'; &lt;/script&gt;";
</span><span class='line'>
</span><span class='line'>&#9;// 根据 code access_token 获取免密用户信息
</span><span class='line'>&#9;// curl -X POST -d "code=XXX" "https://oapi.dingtalk.com/topapi/v2/user/getuserinfo?access_token=XXX"
</span><span class='line'>
</span><span class='line'>&#9;echo "666&lt;br&gt;";
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>function gettoken()
</span><span class='line'>{
</span><span class='line'>&#9;return 'XXX';
</span><span class='line'>
</span><span class='line'>&#9;$cget = new DingTalkClient(DingTalkConstant::$CALL_TYPE_OAPI, DingTalkConstant::$METHOD_GET , DingTalkConstant::$FORMAT_JSON);
</span><span class='line'>&#9;$req = new OapiGettokenRequest();
</span><span class='line'>&#9;$req-&gt;setAppkey($this-&gt;ClientID);
</span><span class='line'>&#9;$req-&gt;setAppsecret($this-&gt;ClientSecret);
</span><span class='line'>&#9;$resp = $cget-&gt;execute($req, '', "https://oapi.dingtalk.com/gettoken");
</span><span class='line'>&#9;var_dump($resp-&gt;access_token);
</span><span class='line'>&#9;var_dump($resp);
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>// 获取jsapiTicket
</span><span class='line'>function jsapiTicket()
</span><span class='line'>{
</span><span class='line'>&#9;$accessToken = $this-&gt;gettoken();
</span><span class='line'>
</span><span class='line'>&#9;$url = "https://api.dingtalk.com/v1.0/oauth2/jsapiTickets";
</span><span class='line'>
</span><span class='line'>&#9;$header = array('Content-Type: application/json', "x-acs-dingtalk-access-token: {$accessToken}");
</span><span class='line'>
</span><span class='line'>&#9;$fields = array(
</span><span class='line'>&#9;&#9;&#9;'1' =&gt; '1'
</span><span class='line'>&#9;&#9;);
</span><span class='line'>&#9;$postfields = json_encode($fields);
</span><span class='line'>&#9;//var_dump($postfields);
</span><span class='line'>&#9;$res = $this-&gt;Wxapi_model-&gt;queryUrl($url, $header, $postfields);
</span><span class='line'>&#9;$res = json_decode($res, true);
</span><span class='line'>&#9;var_dump($res);
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>// 获取免密用户信息
</span><span class='line'>function getuserinfo()
</span><span class='line'>{
</span><span class='line'>&#9;$code = $this-&gt;input-&gt;get('code');
</span><span class='line'>
</span><span class='line'>&#9;$accessToken = $this-&gt;gettoken();
</span><span class='line'>
</span><span class='line'>&#9;$url = "https://oapi.dingtalk.com/topapi/v2/user/getuserinfo?access_token={$accessToken}";
</span><span class='line'>
</span><span class='line'>&#9;$header = array('Content-Type: application/json');
</span><span class='line'>&#9;$fields = array('code' =&gt; $code);
</span><span class='line'>&#9;$postfields = json_encode($fields);
</span><span class='line'>&#9;$res = $this-&gt;Wxapi_model-&gt;queryUrl($url, $header, $postfields);
</span><span class='line'>&#9;$res = json_decode($res, true);
</span><span class='line'>&#9;if (isset($res['errcode']) and $res['errcode'] == 0) {
</span><span class='line'>&#9;&#9;echo $res['errmsg'], "&lt;br&gt;&lt;br&gt;";
</span><span class='line'>&#9;&#9;var_dump($res['result']['userid']);
</span><span class='line'>&#9;&#9;echo "&lt;br&gt;&lt;br&gt;";
</span><span class='line'>&#9;&#9;var_dump($res['result']);
</span><span class='line'>&#9;&#9;echo "&lt;br&gt;&lt;br&gt;";
</span><span class='line'>&#9;}
</span><span class='line'>&#9;var_dump($res);
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>/*
</span><span class='line'>// 批量发送人与机器人会话中机器人消息 样例
</span><span class='line'>curl -X POST -H "x-acs-dingtalk-access-token:"XXX" -H "Content-Type:application/json" -d '{"robotCode":"XXX","userIds":["XXX"],"msgKey":"sampleMarkdown","msgParam":"{\"text\": \"hello text\",\"title\": \"hello title\"}"}' "https://api.dingtalk.com/v1.0/robot/oToMessages/batchSend"
</span><span class='line'>
</span><span class='line'>// 批量发送人与机器人会话中机器人消息
</span><span class='line'>curl -X POST -H "x-acs-dingtalk-access-token:"XXX" -H "Content-Type:application/json" -d '{"robotCode":"XXX","userIds":["XXX"],"msgKey":"sampleLink","msgParam":"{\"text\": \"hello text\",\"title\": \"hello title\",\"picUrl\":\"https://n.com/.png\",\"messageUrl\":\"dingtalk://dingtalkclient/action/openapp?XXX\"}"}' "https://api.dingtalk.com/v1.0/robot/oToMessages/batchSend"
</span><span class='line'>*/
</span><span class='line'>
</span><span class='line'>// 批量发送人与机器人会话中机器人消息 样例
</span><span class='line'>function batchSend_test()
</span><span class='line'>{
</span><span class='line'>&#9;$accessToken = $this-&gt;gettoken();
</span><span class='line'>
</span><span class='line'>&#9;$url = "https://api.dingtalk.com/v1.0/robot/oToMessages/batchSend";
</span><span class='line'>
</span><span class='line'>&#9;$header = array('Content-Type: application/json', "x-acs-dingtalk-access-token: {$accessToken}");
</span><span class='line'>
</span><span class='line'>&#9;$fields = array("robotCode" =&gt; "XXX",
</span><span class='line'>&#9;&#9;&#9;"userIds" =&gt; ["XXX"],
</span><span class='line'>&#9;&#9;&#9;"msgKey" =&gt; "sampleMarkdown",
</span><span class='line'>&#9;&#9;&#9;"msgParam" =&gt; json_encode(["text" =&gt; "hello text", "title" =&gt; "hello title"])
</span><span class='line'>&#9;&#9;);
</span><span class='line'>&#9;$postfields = json_encode($fields);
</span><span class='line'>&#9;//var_dump($postfields);
</span><span class='line'>&#9;$res = $this-&gt;Wxapi_model-&gt;queryUrl($url, $header, $postfields);
</span><span class='line'>&#9;$res = json_decode($res, true);
</span><span class='line'>&#9;var_dump($res);
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>// 批量发送人与机器人会话中机器人消息
</span><span class='line'>function batchSend()
</span><span class='line'>{
</span><span class='line'>&#9;$accessToken = $this-&gt;gettoken();
</span><span class='line'>
</span><span class='line'>&#9;$url = "https://api.dingtalk.com/v1.0/robot/oToMessages/batchSend";
</span><span class='line'>
</span><span class='line'>&#9;$header = array('Content-Type: application/json', "x-acs-dingtalk-access-token: {$accessToken}");
</span><span class='line'>
</span><span class='line'>&#9;$fields = array("robotCode" =&gt; "XXX",
</span><span class='line'>&#9;&#9;&#9;"userIds" =&gt; ["XXX"],
</span><span class='line'>&#9;&#9;&#9;"msgKey" =&gt; "sampleLink",
</span><span class='line'>&#9;&#9;&#9;"msgParam" =&gt; json_encode(["text" =&gt; "hello text", "title" =&gt; "hello title",
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;&#9;"picUrl" =&gt; "https://n.com/gztp4.png",
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;&#9;"messageUrl" =&gt; "dingtalk://dingtalkclient/action/openapp?XXX"])
</span><span class='line'>&#9;&#9;);
</span><span class='line'>&#9;$postfields = json_encode($fields);
</span><span class='line'>&#9;//var_dump($postfields);
</span><span class='line'>&#9;$res = $this-&gt;Wxapi_model-&gt;queryUrl($url, $header, $postfields);
</span><span class='line'>&#9;$res = json_decode($res, true);
</span><span class='line'>&#9;var_dump($res);
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>// 发送工作通知
</span><span class='line'>function MessageCorpconversationAsyncsendV2()
</span><span class='line'>{
</span><span class='line'>&#9;$accessToken = $this-&gt;gettoken();
</span><span class='line'>
</span><span class='line'>&#9;$c = new DingTalkClient(DingTalkConstant::$CALL_TYPE_OAPI, DingTalkConstant::$METHOD_POST , DingTalkConstant::$FORMAT_JSON);
</span><span class='line'>
</span><span class='line'>&#9;$req = new OapiMessageCorpconversationAsyncsendV2Request();
</span><span class='line'>&#9;$req-&gt;setAgentId($this-&gt;AgentId);
</span><span class='line'>&#9;$req-&gt;setUseridList('XXX');
</span><span class='line'>&#9;$req-&gt;setToAllUser(false);
</span><span class='line'>
</span><span class='line'>&#9;/*
</span><span class='line'>&#9;$msg = array(
</span><span class='line'>&#9;&#9;"msgtype" =&gt; "text",
</span><span class='line'>&#9;&#9;"text" =&gt; ["content"=&gt;"12333"],
</span><span class='line'>&#9;&#9;);
</span><span class='line'>&#9;*/
</span><span class='line'>&#9;/*
</span><span class='line'>&#9;$msg = array(
</span><span class='line'>&#9;&#9;"msgtype" =&gt; "link",
</span><span class='line'>&#9;&#9;"link" =&gt; [
</span><span class='line'>&#9;&#9;&#9;"picUrl" =&gt; "https://n.com/gztp4.png",
</span><span class='line'>&#9;&#9;&#9;"messageUrl" =&gt; "https://n.com",
</span><span class='line'>&#9;&#9;&#9;"text" =&gt; "text",
</span><span class='line'>&#9;&#9;&#9;"title" =&gt; "title"
</span><span class='line'>&#9;&#9;&#9;]
</span><span class='line'>&#9;&#9;);
</span><span class='line'>&#9;*/
</span><span class='line'>&#9;$msg = array(
</span><span class='line'>&#9;&#9;"msgtype" =&gt; "link",
</span><span class='line'>&#9;&#9;"link" =&gt; [
</span><span class='line'>&#9;&#9;&#9;"picUrl" =&gt; "https://n.com/gztp4.png",
</span><span class='line'>&#9;&#9;&#9;"messageUrl" =&gt; "dingtalk://dingtalkclient/action/openapp?XXX",
</span><span class='line'>&#9;&#9;&#9;"text" =&gt; "text",
</span><span class='line'>&#9;&#9;&#9;"title" =&gt; "title"
</span><span class='line'>&#9;&#9;&#9;]
</span><span class='line'>&#9;&#9;);
</span><span class='line'>&#9;$req-&gt;setMsg($msg);
</span><span class='line'>
</span><span class='line'>&#9;$resp = $c-&gt;execute($req, $accessToken, "https://oapi.dingtalk.com/topapi/message/corpconversation/asyncsend_v2");
</span><span class='line'>&#9;var_dump($resp);
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>// 获取部门列表
</span><span class='line'>function DepartmentListsub($depid = 1)
</span><span class='line'>{
</span><span class='line'>&#9;$accessToken = $this-&gt;gettoken();
</span><span class='line'>
</span><span class='line'>&#9;$c = new DingTalkClient(DingTalkConstant::$CALL_TYPE_OAPI, DingTalkConstant::$METHOD_POST , DingTalkConstant::$FORMAT_JSON);
</span><span class='line'>&#9;$req = new OapiV2DepartmentListsubRequest();
</span><span class='line'>&#9;$req-&gt;setDeptId($depid);
</span><span class='line'>&#9;$req-&gt;setLanguage("zh_CN");
</span><span class='line'>&#9;$resp = $c-&gt;execute($req, $accessToken, "https://oapi.dingtalk.com/topapi/v2/department/listsub");
</span><span class='line'>&#9;var_dump($resp);
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[腾讯地图--静态地图API]]></title>
    <link href="http://abcdxyzk.github.io/blog/2024/09/14/lang-web-staticmap/"/>
    <updated>2024-09-14T10:37:00+08:00</updated>
    <id>http://abcdxyzk.github.io/blog/2024/09/14/lang-web-staticmap</id>
    <content type="html"><![CDATA[<p><a href="https://lbs.qq.com/service/staticV2/staticGuide/staticDoc#9">https://lbs.qq.com/service/staticV2/staticGuide/staticDoc#9</a></p>

<h4>图标（markers）</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&#9;echo "&lt;td&gt;";
</span><span class='line'>&#9;$mstr = "&markers=" . $latitude . "," . $longitude;
</span><span class='line'>&#9;$labels = "";
</span><span class='line'>&#9;$et = date('H时i分', strtotime($row-&gt;jstime));
</span><span class='line'>&#9;$labels = "&labels=color:0xff0000|bgcolor:0x00ff00|位置{$et}|" . $latitude . "," . $longitude;
</span><span class='line'>&#9;$zoom = ($data['zoom'] == '') ? "" : "&zoom={$data['zoom']}";
</span><span class='line'>&#9;$key = "key";
</span><span class='line'>&#9;$url = "https://apis.map.qq.com/ws/staticmap/v2/?size={$data['size']}{$zoom}&key={$key}{$mstr}{$labels}";
</span><span class='line'>&#9;$pstr = sprintf("&lt;input type=button style='width:40px;vertical-align:baseline;color:blue;' value='%s' onclick=\"showimg('%s','%s')\"&gt;", '预览', $url, $row-&gt;jstime);
</span><span class='line'>&#9;echo $pstr;
</span><span class='line'>&#9;echo "&lt;/td&gt;";</span></code></pre></td></tr></table></div></figure>


<h4>文本（labels） 路径（path）</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>  if (!empty($path)) {
</span><span class='line'>      $pn = count($path);
</span><span class='line'>      if ($pn == 1) {
</span><span class='line'>          $path[] = $path[0];
</span><span class='line'>          $jstime[] = $jstime[0];
</span><span class='line'>          $pn ++;
</span><span class='line'>      }
</span><span class='line'>
</span><span class='line'>      $mstr = "&markers=" . $path[0] . "|" . $path[$pn - 1];
</span><span class='line'>
</span><span class='line'>      //$path = array_reverse($path);
</span><span class='line'>      $pathstr = "weight:3|" . implode('|', $path);
</span><span class='line'>
</span><span class='line'>      $labels = "";
</span><span class='line'>      if ($pn &gt; 1) {
</span><span class='line'>          $st = date('H点i', strtotime($jstime[$pn-1]));
</span><span class='line'>          $et = date('H点i', strtotime($jstime[0]));
</span><span class='line'>          $labels = "&labels=color:0xff0000|bgcolor:0x00aa00|起{$st}|{$path[$pn-1]}|止{$et}|{$path[0]}";
</span><span class='line'>      }
</span><span class='line'>
</span><span class='line'>      $zoom = ($data['zoom'] == '') ? "" : "&zoom={$data['zoom']}";
</span><span class='line'>
</span><span class='line'>      $key = "key";
</span><span class='line'>      $url = "https://apis.map.qq.com/ws/staticmap/v2/?size={$data['size']}{$zoom}&key={$key}&path={$pathstr}{$mstr}{$labels}";
</span><span class='line'>
</span><span class='line'>      echo "&lt;script&gt; document.getElementById('imgid0').src = '{$url}'; &lt;/script&gt;";
</span><span class='line'>
</span><span class='line'>      $sm = strtotime($jstime[$pn-1]);
</span><span class='line'>      $em = strtotime($jstime[0]);
</span><span class='line'>      $mm = (int)(($em - $sm) / 60);
</span><span class='line'>      $ss = (int)($em - $sm) % 60;
</span><span class='line'>      $vv = ($em - $sm != 0) ? round($g1s / ($em - $sm), 2) : 0;
</span><span class='line'>      $dstr= "耗时{$mm}分{$ss}秒; 速度{$vv}米/秒; 路程{$g1s}米; 直线{$disD}米";
</span><span class='line'>      echo "&lt;script&gt; document.getElementById('sid').innerHTML = '{$dstr}'; &lt;/script&gt;";
</span><span class='line'>  }</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[JS 保持屏幕常亮]]></title>
    <link href="http://abcdxyzk.github.io/blog/2024/09/14/lang-web-js-screen-on/"/>
    <updated>2024-09-14T10:33:00+08:00</updated>
    <id>http://abcdxyzk.github.io/blog/2024/09/14/lang-web-js-screen-on</id>
    <content type="html"><![CDATA[<p><a href="https://blog.csdn.net/GeniusCyberpunk/article/details/106082103">https://blog.csdn.net/GeniusCyberpunk/article/details/106082103</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;script src='http://abcdxyzk.github.io/js/NoSleep.js' type='text/javascript'&gt;&lt;/script&gt;
</span><span class='line'>
</span><span class='line'>&lt;script&gt;
</span><span class='line'>var noSleep = new NoSleep();
</span><span class='line'>noSleep.enable();
</span><span class='line'>// alert('eeee');
</span><span class='line'>&lt;/script&gt;</span></code></pre></td></tr></table></div></figure>


<p><a href="https://juejin.cn/post/7229176086147825722">https://juejin.cn/post/7229176086147825722</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;script&gt;
</span><span class='line'>let wakeLock = null;
</span><span class='line'>async function requestScreenWakeLock() {
</span><span class='line'>&#9;try {
</span><span class='line'>&#9;&#9;wakeLock = await navigator.wakeLock.request('screen');
</span><span class='line'>&#9;&#9;// console.log('Wake Lock activated, screen will stay awake.');
</span><span class='line'>&#9;} catch (err) {
</span><span class='line'>&#9;&#9;alert(err);
</span><span class='line'>&#9;}
</span><span class='line'>}
</span><span class='line'>requestScreenWakeLock();
</span><span class='line'>&lt;/script&gt;</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[JS 获取当前的日期和时间]]></title>
    <link href="http://abcdxyzk.github.io/blog/2024/09/14/lang-web-js-date/"/>
    <updated>2024-09-14T10:31:00+08:00</updated>
    <id>http://abcdxyzk.github.io/blog/2024/09/14/lang-web-js-date</id>
    <content type="html"><![CDATA[<p><a href="https://www.jyshare.com/codedemo/7672/">https://www.jyshare.com/codedemo/7672/</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var today = new Date();
</span><span class='line'>
</span><span class='line'>//日期
</span><span class='line'>var DD = String(today.getDate()).padStart(2, '0');    // 获取日
</span><span class='line'>var MM = String(today.getMonth() + 1).padStart(2, '0');   // 获取月份，1 月为 0
</span><span class='line'>var yyyy = today.getFullYear();               // 获取年
</span><span class='line'>
</span><span class='line'>// 时间
</span><span class='line'>hh =  String(today.getHours()).padStart(2, '0');  // 获取当前小时数(0-23)
</span><span class='line'>mm = String(today.getMinutes()).padStart(2, '0'); // 获取当前分钟数(0-59)
</span><span class='line'>ss = String(today.getSeconds()).padStart(2, '0'); // 获取当前秒数(0-59)
</span><span class='line'>
</span><span class='line'>today = yyyy + '-' + MM + '-' + DD + ' ' + hh + ':' + mm + ':' + ss;
</span><span class='line'>document.write(today);</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[GPS 两点距离]]></title>
    <link href="http://abcdxyzk.github.io/blog/2024/09/14/lang-web-js-dist/"/>
    <updated>2024-09-14T10:26:00+08:00</updated>
    <id>http://abcdxyzk.github.io/blog/2024/09/14/lang-web-js-dist</id>
    <content type="html"><![CDATA[<p><a href="https://www.cnblogs.com/thinkquan/p/3925199.html">https://www.cnblogs.com/thinkquan/p/3925199.html</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>function rad($d)
</span><span class='line'>{
</span><span class='line'>&#9;return $d * 3.1415926535898 / 180.0;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>function GetDistance($lat1, $lng1, $lat2, $lng2)
</span><span class='line'>{
</span><span class='line'>&#9;$EARTH_RADIUS = 6378.137;
</span><span class='line'>
</span><span class='line'>&#9;$radLat1 = $this-&gt;rad($lat1);
</span><span class='line'>&#9;$radLat2 = $this-&gt;rad($lat2);
</span><span class='line'>&#9;$a = $radLat1 - $radLat2;
</span><span class='line'>
</span><span class='line'>&#9;$b = $this-&gt;rad($lng1) - $this-&gt;rad($lng2);
</span><span class='line'>
</span><span class='line'>&#9;$s = 2 * asin(sqrt(pow(sin($a/2),2) + cos($radLat1)*cos($radLat2)*pow(sin($b/2),2)));
</span><span class='line'>&#9;$s = $s *$EARTH_RADIUS;
</span><span class='line'>&#9;$s = round($s * 1000);
</span><span class='line'>&#9;return $s;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>GetDistance(26.000000, 118.000000, 25.000000, 117.000000);</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
</feed>
