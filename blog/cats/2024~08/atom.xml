<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: 2024~08 | kk Blog —— 通用基础]]></title>
  <link href="http://abcdxyzk.github.io/blog/cats/2024~08/atom.xml" rel="self"/>
  <link href="http://abcdxyzk.github.io/"/>
  <updated>2024-08-15T11:53:43+08:00</updated>
  <id>http://abcdxyzk.github.io/</id>
  <author>
    <name><![CDATA[kk]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[禁止网页内容复制另存为]]></title>
    <link href="http://abcdxyzk.github.io/blog/2024/08/15/lang-web-js-copy/"/>
    <updated>2024-08-15T11:16:00+08:00</updated>
    <id>http://abcdxyzk.github.io/blog/2024/08/15/lang-web-js-copy</id>
    <content type="html"><![CDATA[<p><a href="https://www.cnblogs.com/webenh/p/5899064.html">https://www.cnblogs.com/webenh/p/5899064.html</a></p>

<p>禁止网页内容复制．粘贴：在<body>中加入以下代码：</p>

<pre><code>    &lt;body onmousemove=/HideMenu()/ oncontextmenu="return false" ondragstart="return false" onselectstart ="return false" onselect="document.selection.empty()" oncopy="document.selection.empty()" onbeforecopy="return false" onmouseup="document.selection.empty()"&gt;
</code></pre>

<p>禁止网页另存为：在<body>后面加入以下代码：</p>

<pre><code>    &lt;noscript&gt;
    &lt;iframe src="*.htm"&gt;&lt;/iframe&gt;
    &lt;/noscript&gt;
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iframe网页嵌套]]></title>
    <link href="http://abcdxyzk.github.io/blog/2024/08/15/lang-web-iframe/"/>
    <updated>2024-08-15T10:59:00+08:00</updated>
    <id>http://abcdxyzk.github.io/blog/2024/08/15/lang-web-iframe</id>
    <content type="html"><![CDATA[<p><a href="https://www.jb51.net/javascript/31553808l.htm">https://www.jb51.net/javascript/31553808l.htm</a></p>

<p>iframe（内嵌框架）是 HTML 中一种用于将一个网页嵌入到另一个网页中的标签，它可以在一个页面中显示来自其他页面的内容。在网页中，使用 <code>&lt;iframe&gt;</code> 标签可以将一个网页嵌套在另一个网页中，实现网页间的互联互通。</p>

<pre><code>    &lt;iframe src="URL"&gt;&lt;/iframe&gt;
</code></pre>

<p>虽然 <code>&lt;iframe&gt;</code> 标签可以很方便地实现上述功能，但是需要注意以下几点：</p>

<p>  嵌入的网页必须与主页面同源，否则会受到浏览器的安全限制。</p>

<p>  嵌入的网页可能会影响页面性能和加载速度，特别是当嵌入的网页包含大量的资源（如图片、CSS 和 JavaScript）时。</p>

<p>  嵌入的网页可能会被恶意攻击者用于钓鱼或注入恶意代码的攻击，因此需要谨慎使用。</p>

<p>总之，在使用 <code>&lt;iframe&gt;</code> 标签时，需要仔细权衡其优缺点，确保安全和性能。</p>

<h2>传值</h2>

<h4>URL传参</h4>

<p>可以在iframe的src属性中使用查询参数（也称为URL参数）将数据传递到嵌入的页面。例如，假设iframe嵌入的页面URL是 index.com/page.html，那么可以使用如下的URL来传递数据：</p>

<pre><code>    &lt;iframe src="index.com/page.html?param1=value1&amp;param2=value2"&gt;&lt;/iframe&gt;
</code></pre>

<p>在嵌入的页面中，可以使用JavaScript获取查询参数并使用它们：
<code>
    var params = new URLSearchParams(window.location.search);
    var param1 = params.get('param1');
    var param2 = params.get('param2');
</code></p>

<p> 或者写一个函数获取对应的值（该方法来自拓维的一位前端工程师大佬）：</p>

<h4>5.2 postMessage（）传参</h4>

<pre><code>    //从url获取参数
    export const getQuery = (name: string, url?: string) =&gt; {
        const params = new URLSearchParams(url || window.location.search);
        const value = params.get(name);
        if (value) {
            return value;
        }
        return getQueryString(name, url);
    };

    export const getQueryString = (name: string, url?: string) =&gt; {
        const reg = new RegExp('(^|&amp;|/?)' + name + '=([^&amp;]*)(&amp;|$)', 'i');
        const r = encodeURI(url || window.location.search || window.location.href || window.location.hash)
            .substr(1)
            .match(reg);
        if (r != null) return unescape(r[2]);
        return null;
    };
</code></pre>

<p>postMessage()方法是一种用于在不同窗口或文档之间传递消息的通用方法，它可以实现跨域通信。在使用postMessage()方法时，需要在发送消息的窗口（发送方）和接收消息的窗口（接收方）中分别编写代码。</p>

<h4>5.2.1 子传父：</h4>

<p>子：
<code>
    // 发送消息给接收方窗口
    window.parent.postMessage("Hello, parent!", "http://parent.com");
</code></p>

<p>父：
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
<span class='line-number'>259</span>
<span class='line-number'>260</span>
<span class='line-number'>261</span>
<span class='line-number'>262</span>
<span class='line-number'>263</span>
<span class='line-number'>264</span>
<span class='line-number'>265</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// 监听message事件，接收消息
</span><span class='line'>window.addEventListener(&ldquo;message&rdquo;, receiveMessage, false);&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;function receiveMessage(event) {
</span><span class='line'>// 判断消息来源是否是指定的发送方窗口
</span><span class='line'>if (event.origin === "http://child.com") {
</span><span class='line'>    // 处理接收到的消息
</span><span class='line'>    console.log(event.data);
</span><span class='line'>}
</span><span class='line'>}
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;
</span><span class='line'>#### 5.2.2 父传子：
</span><span class='line'>
</span><span class='line'>父：
</span><span class='line'>
</span><span class='line'>创建实例对象：
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;const iframe = document.getElementById('my-iframe');
</span><span class='line'>const iframeWindow = iframe.contentWindow;
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;发送消息：
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;const message = { type: 'GREETINGS', data: 'Hello, child!' };
</span><span class='line'>const targetOrigin = 'http://child.com'; // 指定接收方的源
</span><span class='line'>iframeWindow.postMessage(message, targetOrigin);
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;子：
</span><span class='line'>
</span><span class='line'>接收消息
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;window.addEventListener('message', receiveMessage, false);
</span><span class='line'>
</span><span class='line'>function receiveMessage(event) {
</span><span class='line'>if (event.origin === 'http://parent.com') { // 验证消息来源
</span><span class='line'>    console.log(event.data); // 处理接收到的消息
</span><span class='line'>}
</span><span class='line'>}
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;```
</span><span class='line'>以上就是iframe的基本介绍与使用的详细内容.&lt;/p&gt;
</span><span class='line'>]]&gt;&lt;/content&gt;
</span><span class='line'>  &lt;/entry&gt;
</span><span class='line'>  
</span><span class='line'>  &lt;entry&gt;
</span><span class='line'>&lt;title type="html"&gt;&lt;![CDATA[textarea自动调整高宽]]&gt;&lt;/title&gt;
</span><span class='line'>&lt;link href="http://abcdxyzk.github.io/blog/2024/08/15/lang-web-auto-textarea/"/&gt;
</span><span class='line'>&lt;updated&gt;2024-08-15T10:42:00+08:00&lt;/updated&gt;
</span><span class='line'>&lt;id&gt;http://abcdxyzk.github.io/blog/2024/08/15/lang-web-auto-textarea&lt;/id&gt;
</span><span class='line'>&lt;content type="html"&gt;&lt;![CDATA[&lt;p&gt;&lt;a href="https://blog.51cto.com/haihuiwei/1734068"&gt;https://blog.51cto.com/haihuiwei/1734068&lt;/a&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;    /**
</span><span class='line'> * 统计区分中英文字符字数
</span><span class='line'> */
</span><span class='line'>function getWordsCnt(str)
</span><span class='line'>{
</span><span class='line'>    var n = 0;
</span><span class='line'>    var ch = 0;
</span><span class='line'>    for(var i = 0; i &lt; str.length; i ++){
</span><span class='line'>        var ch = str.charCodeAt(i);
</span><span class='line'>        if (ch &gt; 255) { // 中文字符集
</span><span class='line'>            n += 2;
</span><span class='line'>            ch = 1;
</span><span class='line'>        } else {
</span><span class='line'>            n ++;
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>    if (ch == 1) {
</span><span class='line'>        if (n &gt;= 23)
</span><span class='line'>            return 160;
</span><span class='line'>        if (n &gt;= 19)
</span><span class='line'>            return 140;
</span><span class='line'>        if (n &gt;= 15)
</span><span class='line'>            return 110;
</span><span class='line'>        if (n &gt;= 10)
</span><span class='line'>            return 92;
</span><span class='line'>        if (n &gt; 7)
</span><span class='line'>            return 80;
</span><span class='line'>    } else {
</span><span class='line'>        if (n &gt;= 22)
</span><span class='line'>            return 150;
</span><span class='line'>        if (n &gt;= 18)
</span><span class='line'>            return 135;
</span><span class='line'>        if (n &gt;= 14)
</span><span class='line'>            return 110;
</span><span class='line'>        if (n &gt;= 10)
</span><span class='line'>            return 90;
</span><span class='line'>        if (n &gt; 7)
</span><span class='line'>            return 80;
</span><span class='line'>    }
</span><span class='line'>    return 0;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>function autoTextarea (elem, extra, maxHeight)
</span><span class='line'>{
</span><span class='line'>    extra = extra || 0;
</span><span class='line'>    var isFirefox = !!document.getBoxObjectFor || 'mozInnerScreenX' in window,
</span><span class='line'>    isOpera = !!window.opera &amp;&amp; !!window.opera.toString().indexOf('Opera'),
</span><span class='line'>    addEvent = function (type, callback) {
</span><span class='line'>        elem.addEventListener ?
</span><span class='line'>            elem.addEventListener(type, callback, false) :
</span><span class='line'>            elem.attachEvent('on' + type, callback);
</span><span class='line'>    },
</span><span class='line'>    getStyle = elem.currentStyle ? function (name) {
</span><span class='line'>        var val = elem.currentStyle[name];
</span><span class='line'>        if (name === 'height' &amp;&amp; val.search(/px/i) !== 1) {
</span><span class='line'>            var rect = elem.getBoundingClientRect();
</span><span class='line'>            return rect.bottom - rect.top -
</span><span class='line'>                parseFloat(getStyle('paddingTop')) -
</span><span class='line'>                parseFloat(getStyle('paddingBottom')) + 'px';
</span><span class='line'>        };
</span><span class='line'>        return val;
</span><span class='line'>    } : function (name) {
</span><span class='line'>        return getComputedStyle(elem, null)[name];
</span><span class='line'>    },
</span><span class='line'>    minHeight = parseFloat(getStyle('height'));
</span><span class='line'>
</span><span class='line'>    elem.style.resize = 'none';
</span><span class='line'>    var change = function () {
</span><span class='line'>        var scrollTopp, height,
</span><span class='line'>            padding = 0,
</span><span class='line'>            style = elem.style;
</span><span class='line'>        if (elem._length === elem.value.length) return;
</span><span class='line'>        elem._length = elem.value.length;
</span><span class='line'>        if (!isFirefox &amp;&amp; !isOpera) {
</span><span class='line'>            padding = parseInt(getStyle('paddingTop')) + parseInt(getStyle('paddingBottom'));
</span><span class='line'>        };
</span><span class='line'>        scrollTopp = document.body.scrollTopp || document.documentElement.scrollTopp;
</span><span class='line'>        elem.style.height = minHeight + 'px';
</span><span class='line'>
</span><span class='line'>        // 控制最小宽度
</span><span class='line'>        var minw = getWordsCnt(elem.value);
</span><span class='line'>        if (elem.style.minWidth &lt; minw)
</span><span class='line'>            elem.style.minWidth = minw;
</span><span class='line'>
</span><span class='line'>        if (elem.scrollHeight &gt; minHeight) {
</span><span class='line'>            if (maxHeight &amp;&amp; elem.scrollHeight &gt; maxHeight) {
</span><span class='line'>                height = maxHeight - padding;
</span><span class='line'>                style.overflowY = 'auto';
</span><span class='line'>            } else {
</span><span class='line'>                height = elem.scrollHeight - padding;
</span><span class='line'>                style.overflowY = 'hidden';
</span><span class='line'>            };
</span><span class='line'>            style.height = height + extra + 'px';
</span><span class='line'>            scrollTopp += parseInt(style.height) - elem.currHeight;
</span><span class='line'>            document.body.scrollTopp = scrollTopp;
</span><span class='line'>            document.documentElement.scrollTopp = scrollTopp;
</span><span class='line'>            elem.currHeight = parseInt(style.height);
</span><span class='line'>        };
</span><span class='line'>    };
</span><span class='line'>    addEvent('propertychange', change);
</span><span class='line'>    addEvent('input', change);
</span><span class='line'>    addEvent('focus', change);
</span><span class='line'>    change();
</span><span class='line'>}
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>]]&gt;&lt;/content&gt;
</span><span class='line'>  &lt;/entry&gt;
</span><span class='line'>  
</span><span class='line'>  &lt;entry&gt;
</span><span class='line'>&lt;title type="html"&gt;&lt;![CDATA[NTP log 记录每次发包]]&gt;&lt;/title&gt;
</span><span class='line'>&lt;link href="http://abcdxyzk.github.io/blog/2024/08/09/ntpd-log/"/&gt;
</span><span class='line'>&lt;updated&gt;2024-08-09T17:25:00+08:00&lt;/updated&gt;
</span><span class='line'>&lt;id&gt;http://abcdxyzk.github.io/blog/2024/08/09/ntpd-log&lt;/id&gt;
</span><span class='line'>&lt;content type="html"&gt;&lt;![CDATA[&lt;p&gt;vim /etc/ntp.conf&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;logfile /var/log/ntp.log&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h4&gt;修改rpm&lt;/h4&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;&lt;a href="https://rpmfind.net/linux/RPM/centos/7.9.2009/x86_64/Packages/ntp-4.2.6p5-29.el7.centos.2.x86_64.html"&gt;https://rpmfind.net/linux/RPM/centos/7.9.2009/x86_64/Packages/ntp-4.2.6p5-29.el7.centos.2.x86_64.html&lt;/a&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;    diff --git a/libntp/humandate.c b/libntp/humandate.c
</span><span class='line'>index 705f4c8..ece409e 100644
</span><span class='line'>--- a/libntp/humandate.c
</span><span class='line'>+++ b/libntp/humandate.c
</span><span class='line'>@@ -26,9 +26,14 @@ humanlogtime(void)
</span><span class='line'>
</span><span class='line'>    LIB_GETBUF(bp);
</span><span class='line'>
</span><span class='line'>+/*
</span><span class='line'>    snprintf(bp, LIB_BUFLENGTH, "%2d %s %02d:%02d:%02d",
</span><span class='line'>         tm-&gt;tm_mday, months[tm-&gt;tm_mon],
</span><span class='line'>         tm-&gt;tm_hour, tm-&gt;tm_min, tm-&gt;tm_sec);
</span><span class='line'>+*/
</span><span class='line'>+   snprintf(bp, LIB_BUFLENGTH, "%04d-%02d-%02d %02d:%02d:%02d",
</span><span class='line'>+        tm-&gt;tm_year + 1900, tm-&gt;tm_mon + 1, tm-&gt;tm_mday,
</span><span class='line'>+        tm-&gt;tm_hour, tm-&gt;tm_min, tm-&gt;tm_sec);
</span><span class='line'>
</span><span class='line'>    return bp;
</span><span class='line'> }
</span><span class='line'>diff --git a/ntpd/ntp_io.c b/ntpd/ntp_io.c
</span><span class='line'>index 89b1e96..46d1692 100644
</span><span class='line'>--- a/ntpd/ntp_io.c
</span><span class='line'>+++ b/ntpd/ntp_io.c
</span><span class='line'>@@ -3191,6 +3191,9 @@ sendpkt(
</span><span class='line'>        DPRINTF(2, ("%ssendpkt(%d, dst=%s, src=%s, ttl=%d, len=%d)\n",
</span><span class='line'>                ismcast ? "\tMCAST\t***** " : "", src-&gt;fd,
</span><span class='line'>                stoa(dest), stoa(&amp;src-&gt;sin), ttl, len));
</span><span class='line'>+       msyslog(LOG_INFO, "%ssendpkt(%d, dst=%s, src=%s, ttl=%d, len=%d)\n",
</span><span class='line'>+               ismcast ? "\tMCAST\t***** " : "", src-&gt;fd,
</span><span class='line'>+               stoa(dest), stoa(&amp;src-&gt;sin), ttl, len);
</span><span class='line'> #ifdef MCAST
</span><span class='line'>        /*
</span><span class='line'>         * for the moment we use the bcast option to set multicast ttl
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;h4&gt;tail -f /var/log/ntp.log&lt;/h4&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;    2024-08-09 17:23:14 ntpd[45933]: sendpkt(19, dst=106.55.184.199, src=192.168.100.80, ttl=0, len=48)
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>]]&gt;&lt;/content&gt;
</span><span class='line'>  &lt;/entry&gt;
</span><span class='line'>  
</span><span class='line'>  &lt;entry&gt;
</span><span class='line'>&lt;title type="html"&gt;&lt;![CDATA[NTP服务配置]]&gt;&lt;/title&gt;
</span><span class='line'>&lt;link href="http://abcdxyzk.github.io/blog/2024/08/09/ntpd/"/&gt;
</span><span class='line'>&lt;updated&gt;2024-08-09T16:43:00+08:00&lt;/updated&gt;
</span><span class='line'>&lt;id&gt;http://abcdxyzk.github.io/blog/2024/08/09/ntpd&lt;/id&gt;
</span><span class='line'>&lt;content type="html"&gt;&lt;![CDATA[&lt;p&gt;&lt;a href="https://www.jianshu.com/p/25ab49103e4d"&gt;https://www.jianshu.com/p/25ab49103e4d&lt;/a&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;&lt;a href="https://www.cnblogs.com/tdyizhen1314/p/17085917.html"&gt;https://www.cnblogs.com/tdyizhen1314/p/17085917.html&lt;/a&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;&lt;a href="https://www.cnblogs.com/21summer/p/14819406.html"&gt;https://www.cnblogs.com/21summer/p/14819406.html&lt;/a&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;vim /etc/ntp.conf&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h4&gt;0 log&lt;/h4&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;logfile /var/log/ntp.log&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h4&gt;1 restrict&lt;/h4&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;作用: 对ntp做权限控制&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;    ignore: 忽略所有类型的NTP连接请求
</span><span class='line'>nomodify: 限制客户端不能使用命令ntpc和ntpq来修改服务器端的时间
</span><span class='line'>noquery: 不提供NTP网络校时服务
</span><span class='line'>notrap: 不接受远程登录请求
</span><span class='line'>notrust: 不接受没有经过认证的客户端的请求
</span><span class='line'>nopeer: 用于阻止主机尝试与服务器对等，并允许欺诈性服务器控制时钟
</span><span class='line'>kod: 访问违规时发送KoD 包。
</span><span class='line'>restrict -6 表示IPV6地址的权限设置。
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;【如果没有用任何参数，那么表示不做任何限制】&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;例子:
</span><span class='line'>&lt;code&gt;
</span><span class='line'>restrict 10.220.5.0 mask 255.255.255.0 nomodify
</span><span class='line'>&lt;/code&gt;
</span><span class='line'>允许10.220.5.0/24 网段主机进行时间同步&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h4&gt;server&lt;/h4&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;作用: 指定ntp服务器的地址&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;格式:</span></code></pre></td></tr></table></div></figure>
    server host [ key n ] [ version n ] [ prefer ] [ mode n ] [ minpoll n ] [ maxpoll n ] [ iburst ]</p>

<pre><code>其中host是上层NTP服务器的IP地址或域名，随后所跟的参数解释如下所示：
 key：       表示所有发往服务器的报文包含有秘钥加密的认证信息，n是32位的整数，表示秘钥号。
 version： 表示发往上层服务器的报文使用的版本号，n默认是3，可以是1或者2。
 prefer：   如果有多个server选项，具有该参数的服务器优先使用。
 mode：   指定数据报文mode字段的值。
 minpoll： 指定与查询该服务器的最小时间间隔为2的n次方秒，n默认为6，范围为4-14。
 maxpoll：指定与查询该服务器的最大时间间隔为2的n次方秒，n默认为10，范围为4-14。
 iburst：   当初始同步请求时，采用突发方式接连发送8个报文，时间间隔为2秒。
</code></pre>

<pre><code>server 127.127.1.0 # 将当前主机作为时间服务器


### 3、fudge

作用: 设置时间服务器的层级

格式: 
</code></pre>

<pre><code>fudge ip [stratum int]
</code></pre>

<pre><code>
例子: 
</code></pre>

<pre><code>fudge 10.225.5.1 stratum 10
</code></pre>

<pre><code>注意: fudge必须和server一块用， 而且是在server的下一行

stratum 0~15

0: 表示顶级

10: 通常用于给局域网主机提供时间服务

#### 4、通过 ntpq -p 静态查看NTP服务器与外部NTP服务器同步情况。
</code></pre>

<pre><code>st: 即stratum阶层，值越小表示ntp serve的精准度越高。
when: 几秒前曾做过时间同步更新的操作。
poll: 表示，每隔多少毫秒与ntp server同步一次。
reach: 已经向上层NTP服务器要求更新的次数。
delay: 网络传输过程钟延迟的时间。
offset: 时间补偿的结果。
jitter: Linux系统时间与BIOS硬件时间的差异时间。
</code></pre>

<pre><code>

#### 1000s

ntp服务默认当本地时间与上级ntp时间差超过1000s，那么ntp进程就会退出并在系统日志文件中记录。若不希望出现ntp进程退出的情况，可使用参数选项，如下：

tinker panic 600 时间差超过600，ntp进程会退出。

tinker panic 0   ntp忽略阈值参数检测，不会因为超过阈值而自动将服务down掉，这可以保证ntpd在时间差较大时依然工作。


#### 开启日志

使用statsdir和filegen开启统计分析。

设定方式：
</code></pre>

<pre><code>statsdir /var/log/ntpstats/

statistics loopstats peerstats clockstats
filegen loopstats file loopstats type day enable
filegen peerstats file peerstats type day enable
filegen clockstats file clockstats type day enable
</code></pre>

<p>```
当打开统计分析时，ntp会在/var/log/ntpstats/目录下产生filegen中所设定的统计文件。</p>

<h4>更多统计选项</h4>

<p><a href="https://docs.ntpsec.org/latest/ntp_conf.html">https://docs.ntpsec.org/latest/ntp_conf.html</a></p>

<h2 id="monit">6. Monitoring Support</h2>




<div class="sectionbody">
<div class="paragraph">
<p>ntpd(8) includes a comprehensive monitoring facility suitable
for continuous, long term recording of server and client timekeeping
performance. See the <code>statistics</code> command below for a listing and example of
each type of statistics currently supported. Statistic files are managed
using file generation sets and scripts in the ./scripts directory of this
distribution. Using these facilities and UNIX cron(8) jobs, the data
can be automatically summarized and archived for retrospective
analysis.</p>
</div>
<div class="sect2">
<h3 id="_monitoring_commands">6.1. Monitoring Commands</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><a id="statistics"></a><code>statistics</code> <em>name…​</em></dt>
<dd>
<p>Enables writing of statistics records. Currently, ten kinds of
<em>name</em> statistics are supported.</p>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>clockstats</code></dt>
<dd>
<p>Enables recording of clock driver statistics information. Each
update received from a clock driver appends a line of the following
form to the file generation set named <em>clockstats</em>:</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">49213 525.624 SPECTRACOM(1) 93 226 00:08:29.606</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Item</th>
<th class="tableblock halign-left valign-top">Units</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">49213</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MJD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">modified Julian day number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">525.624</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time of day (s) past midnight UTC</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPECTRACOM(1)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">receiver identifier (Spectracom unit 1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">93 226 00:08:29.606</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">timecode (format varies by refclock)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The first two fields show the date (Modified Julian Day) and time
(seconds and fraction past UTC midnight). The next
normally shows clock type and unit (but if you are running in strict
Classic compatibility mode it will show the magic clock address in
dotted-quad notation). The final field is the last timecode received from the
clock in decoded ASCII format, where meaningful. For some clock drivers,
a good deal of additional information can be gathered and displayed as
well. See information specific to each clock for further details.</p>
</div>
</dd>
<dt class="hdlist1"><code>loopstats</code></dt>
<dd>
<p>Enables recording of loop filter statistics information. Each update
of the local clock outputs a line of the following form to the file
generation set named <em>loopstats</em>:</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">50935 75440.031 0.000006019 13.778190 0.000351733 0.0133806</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Item</th>
<th class="tableblock halign-left valign-top">Units</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>50935</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MJD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>75440.031</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time past midnight</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.000006019</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clock offset</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>13.778</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PPM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">drift (frequency offset)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.000351733</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RMS jitter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.013380</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PPM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RMS frequency jitter (aka wander)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>6</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">log<sub>2</sub> s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clock discipline loop time constant</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The first two fields show the date (Modified Julian Day) and time
(seconds and fraction past UTC midnight). The next five fields show
time offset (seconds), frequency offset (parts per million - PPM),
RMS jitter (seconds), Allan deviation (PPM) and clock discipline
time constant.</p>
</div>
</dd>
<dt class="hdlist1"><code>ntsstats</code></dt>
<dd>
<p>Enables recording of NTS statistics counters on a periodic basis.
Each hour a line of the following form is appended to the file
generation set named <em>ntsstats</em>:</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">60209 77147.187 3600 1320 1239 0 2895 2895 11 4104 0 2897 2885 10 0 0 2 0</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Item</th>
<th class="tableblock halign-left valign-top">Units</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>60209</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MJD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>77147.187</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time past midnight</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3600</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time since reset</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1320</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">packets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">client requests sent</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1239</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">packets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">client responses received good</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">packets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">client responses received bad</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2895</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">packets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">server responses sent</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2895</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">packets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">server requests received good</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">packets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">server requests received bad</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4104</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">packets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cookies made</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">packets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cookie decodes not server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2897</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">packets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cookie decodes total</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2885</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">packets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cookie decodes current</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">packets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cookie decodes 1-2 days</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">packets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cookie decodes 2-3 days</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">packets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cookie decodes 3-10 days</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">packets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cookie decodes too old</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">packets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cookie decodes error</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These counters are also available via <em>ntpq</em>'s <em>nts</em> command.</p>
</div>
</dd>
<dt class="hdlist1"><code>ntskestats</code></dt>
<dd>
<p>Enables recording of NTS-KE statistics counters on a periodic basis.
Each hour a line of the following form is appended to the file
generation set named <em>ntskestats</em>:</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">60209 77147.187 3600 10 2.914 0.026 2 3.218 0.004 0 0.000 0.000 0 0</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Item</th>
<th class="tableblock halign-left valign-top">Units</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>60209</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MJD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>77147.187</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time past midnight</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3600</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time since reset</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">requests</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">server requests good</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2.914</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">server good wall clock time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.026</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">server good CPU time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">requests</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">server requests no-TLS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3.218</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">server no-TLS wall clock time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.004</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">server no-TLS CPU time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">requests</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">server requests bad</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">server bad wall clock time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">server bad CPU time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">requests</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">client requests good</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">requests</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">client requests bad</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These counters are also available via <em>ntpq</em>'s <em>nts</em> command.</p>
</div>
<div class="paragraph">
<p>There are two types of failures for NTS-KE server processing.
The <em>no-TLS</em> slots are for the path when the TLS connection doesn’t get setup.
The <em>bad</em> slots are for the path when the TLS connection does get setup
but there is an error during the NTS-KE exchange.</p>
</div>
<div class="paragraph">
<p>Both are typically caused by bad guys probing for servers to abuse.
A <em>no-TLS</em> event would be caused by a bad guy using unencrypted SMTP while a <em>bad</em> event would be caused by SMTP over TLS.</p>
</div>
</dd>
<dt class="hdlist1"><code>protostats</code></dt>
<dd>
<p>Record significant peer and system events. Each significant
event appends one line to the <code>protostats</code> file set:</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">49213 525.624 128.4.1.1 963a 8a <em>message</em></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Item</th>
<th class="tableblock halign-left valign-top">Units</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>49213</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MJD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>525.624</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time past midnight</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>128.4.1.1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">source address (<code>0.0.0.0</code> for system)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>963a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">status word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">event message code</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>message</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">event message</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The event message code and <em>message</em> field are described on the
"Event Messages and Status Words" page.</p>
</div>
</dd>
<dt class="hdlist1"><code>peerstats</code></dt>
<dd>
<p>Enables recording of peer statistics information. This includes
statistics records of all peers of an NTP server and of special
signals, where present and configured. Each valid update appends a
line of the following form to the current element of a file
generation set named <em>peerstats</em>:</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">48773 10847.650 SPECTRACOM(4) 9714 -0.001605376 0.000000000 0.001424877 0.000958674</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Item</th>
<th class="tableblock halign-left valign-top">Units</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>48773</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MJD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10847.650</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time past midnight</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SPECTRACOM(4)</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clock name (unit) or source address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>9714</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">status word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-0.001605376</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clock offset</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.000000000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">roundtrip delay</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.001424877</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dispersion</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.000958674</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RMS jitter</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The first two fields show the date (Modified Julian Day) and time
(seconds and fraction past UTC midnight). The third field shows
the reference clock type and unit number (but if you are running in
the peer address in dotted-quad notation instead) The fourth field
is a status word, encoded in hex in the format described in
Appendix A of the NTP specification RFC 1305. The final four fields
show the offset, delay, dispersion and RMS jitter, all in seconds.</p>
</div>
</dd>
<dt class="hdlist1"><code>rawstats</code></dt>
<dd>
<p>Enables recording of raw-timestamp statistics information. This
includes statistics records of all peers of an NTP server and of
special signals, where present and configured. Each NTP message
received from a peer or clock driver appends a line of the following
form to the file generation set named <em>rawstats</em>:</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">59786 36302.768 2610:20:6f15:15::27 2604:a880:1:20::17:5001 3867818701.119346355 3867818701.152009264 3867818701.152010426 3867818702.768490825 0 3 4 1 13 -29 0.000244 0.000488 .NIST. 0 1 2000</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Units</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">59786</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MJD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">36302.768</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time past midnight</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2610:20:6f15:15::27</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">source address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2604:a880:1:20::17:5001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">destination address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3867818701.119346355</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NTP s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">origin timestamp</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3867818701.152009264</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NTP s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">receive timestamp</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3867818701.152010426</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NTP s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">transmit timestamp</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3867818702.768490825</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NTP s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">destination timestamp</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0: OK, 1: insert pending, 2: delete pending, 3: not synced</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">leap warning indicator</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 was current in 2012</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NTP version</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3: client, 4: server, 6: ntpq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-15, 16: not synced</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stratum</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">log<sub>2</sub> seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">poll</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-29</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">log<sub>2</sub> seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">precision</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.000244</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">total roundtrip delay from the remote server to the primary reference clock</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.000488</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">total dispersion from the remote server to the primary reference clock</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NIST.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP or text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">refid, association ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lost packets since last response</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dropped packets since last request</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hex integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 if packet accecpted, BOGON flag if packet is discarded</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The first two fields show the date (Modified Julian Day) and time
(seconds and fraction past UTC midnight). The next two fields show
the remote IP Address followed by the local address.
The next four fields show the originate,
receive, transmit and final NTP timestamps in order. The timestamp
values are as received and before processing by the various data
smoothing and mitigation algorithms.</p>
</div>
<div class="paragraph">
<p>A packet that is accecpted is logged.
At most the first dropped packet per request is logged.
That avoids DDoSing the log file.</p>
</div>
<div class="paragraph">
<p>The BOGON flags are decoded <a href="decode.html#flash">here</a>.</p>
</div>
</dd>
<dt class="hdlist1"><code>sysstats</code></dt>
<dd>
<p>Enables recording of ntpd statistics counters on a periodic basis.
Each hour a line of the following form is appended to the file
generation set named <em>sysstats</em>:</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">59935 82782.547 3600 36082754 31287166 26510580 4779042 113 19698 1997 428 4773352 0 366120</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Item</th>
<th class="tableblock halign-left valign-top">Units</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>59935</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MJD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>82782.547</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time past midnight</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3600</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time since reset</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>36082754</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">packets received</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31287166</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">packets processed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>26510580</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">current version</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4779042</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">old version(s)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>113</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">access denied</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>19698</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bad length or format</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1997</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bad authentication</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>428</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">declined</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4773352</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rate exceeded</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kiss-o'-death packets sent</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>366120</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NTPv1 packets received</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The first two fields show the date (Modified Julian Day) and time
(seconds and fraction past UTC midnight). The remaining ten fields
show the statistics counter values accumulated since the last
generated line.</p>
</div>
</dd>
<dt class="hdlist1"><code>usestats</code></dt>
<dd>
<p>Enables recording of ntpd resource usage statistics.
Each hour a line of the following form is appended to the file
generation set named <em>usestats</em>:</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">57570 83399.541 3600 0.902 1.451 164 0 0 0 2328 64226 1 0 4308</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Item</th>
<th class="tableblock halign-left valign-top">Units</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>57570</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MJD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>83399.541</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time past midnight</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3600</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time since reset</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.902</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ru_utime: CPU seconds - user mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.451</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ru_stime: CPU seconds - system</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>164</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ru_minflt: page faults - reclaim/soft (no I/O)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ru_majflt: page faults - I/O</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ru_nswap: process swapped out</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ru_inblock: file blocks in</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2328</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ru_oublock: file blocks out</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>64226</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ru_nvcsw: context switches, wait</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ru_nivcsw: context switches, preempts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ru_nsignals: signals</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4308</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ru_maxrss: resident set size, kilobytes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The first two fields show the date (Modified Julian Day) and time
(seconds and fraction past UTC midnight).  The ru_ tags are the
names from the rusage struct.  See <code>man getrusage</code> for details.
(The NetBSD and FreeBSD man pages have more details.)
The maxrss column is the high water mark since the process was started.
The remaining fields show the values used since the last report.</p>
</div>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a id="statsdir"></a><code>statsdir</code> <em>directory_path</em></dt>
<dd>
<p>Indicates the full path of a directory where statistics files should
be created (see below). This keyword allows the (otherwise constant)
<em>filegen</em> filename prefix to be modified for file generation sets,
which is useful for handling statistics logs.</p>
</dd>
<dt class="hdlist1"><a id="filegen"></a><code>filegen</code> <em>name</em> [<code>file</code> <em>filename</em>] [<code>type</code> <em>typename</em>] [<code>link</code> | <code>nolink</code>] [<code>enable</code> | <code>disable</code>]</dt>
<dd>
<p>Configures setting of the generation file set name. Generation file sets
provide a means for handling files that are continuously growing
during the lifetime of a server. Server statistics are a typical
example for such files. Generation file sets provide access to a set
of files used to store the actual data. At any time at most one
element of the set is being written to. The type given specifies
when and how data will be directed to a new element of the set. This
way, information stored in elements of a file set that are currently
unused are available for administrative operations without the
risk of disturbing the operation of ntpd. (Most important: they can
be removed to free space for new data produced.)</p>
<div class="paragraph">
<p>Note that this command can be sent from the
ntpq(1) program running at a remote location.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>name</code></dt>
<dd>
<p>This is the type of the statistics records, as shown in the
<em>statistics</em> command.</p>
</dd>
<dt class="hdlist1"><code>file</code> <em>filename</em></dt>
<dd>
<p>This is the file name for the statistics records. Filenames of set
members are built from three concatenated elements <em>prefix</em>,
<em>filename</em> and <em>suffix</em>:</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>prefix</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is a constant filename path. It is not subject to
        modifications via the <em>filegen</em> option. It is defined by the
        server, usually specified as a compile-time constant. It may,
        however, be configurable for individual file generation sets via
        other commands. For example, the prefix used with <em>loopstats</em>
        and <em>peerstats</em> generation can be configured using the
        <em>statsdir</em> option explained above.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>filename</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This string is directly concatenated to the prefix mentioned
        above (no intervening ‘/’). This can be modified using the file
        argument to the <em>filegen</em> statement. No <code>..</code> elements are
        allowed in this component to prevent filenames referring to
        parts outside the filesystem hierarchy denoted by <em>prefix</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>suffix</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This part is reflects individual elements of a
    file set. It is generated according to the type of a file set.</p></td>
</tr>
</tbody>
</table>
</dd>
<dt class="hdlist1"><code>type</code> <em>typename</em></dt>
<dd>
<p>A file generation set is characterized by its type. The following
types are supported:
// The following are tables only because indent lists cannot be
// nested more than 2 deep.</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>none</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The file set is actually a single plain file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One element of file set is used per incarnation of a ntpd
        server. This type does not perform any changes to file set
        members during runtime, however it provides an easy way of
        separating files belonging to different ntpd(8) server
        incarnations. The set member filename is built by appending a
        ‘.’ to concatenated prefix and filename strings, and appending the
        decimal representation of the process ID of the
        ntpd(8) server process.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>day</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One file generation set element is created per day. A day is
        defined as the period between 00:00 and 24:00 UTC. The file set
        member suffix consists of a ‘.’ and a day specification in the
        form <em>YYYYMMdd</em>. <em>YYYY</em> is a 4-digit year number (e.g., 1992).
        <em>MM</em> is a two digit month number. <em>dd</em> is a two digit day
        number. Thus, all information written at 10 December 1992 would
        end up in a file named <em>prefix</em> <em>filename</em>.19921210.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>week</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any file set member contains data related to a certain
    week of a year. The term week is defined by computing
    day-of-year modulo 7. Elements of such a file generation set
    are distinguished by appending the following suffix to the
    file set filename base: A dot, a 4-digit year number, the
    letter <em>W</em>, and a 2-digit week number. For example,
    information from January, 10th 1992 would end up in a file
    with suffix <em>1992W1</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>month</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One generation file set element is generated per
    month. The file name suffix consists of a dot, a 4-digit year
    number, and a 2-digit month.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>year</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One generation file element is generated per year.
    The filename  suffix consists of a dot and a 4 digit year number.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>age</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This type of file generation sets changes to a new element of
        the file set every 24 hours of server operation. The filename
        suffix consists of a dot, the letter <em>a</em>, and an 8-digit number.
        This number is taken to be the number of seconds the server is
        running at the start of the corresponding 24-hour period.</p></td>
</tr>
</tbody>
</table>
</dd>
<dt class="hdlist1"><code>link</code> | <code>nolink</code></dt>
<dd>
<p>It is convenient to be able to access the current element of a
file generation set by a fixed name. This feature is enabled by
specifying <code>link</code> and disabled using <code>nolink</code>. If link is
specified, a hard link from the current file set element to a file
without suffix is created. When there is already a file with this
name and the number of links of this file is one, it is renamed
appending a dot, the letter <em>C</em>, and the pid of the ntpd server
process. When the number of links is greater than one, the file is
unlinked. This allows the current file to be accessed by a
constant name.</p>
</dd>
<dt class="hdlist1"><code>enable</code> | <code>disable</code></dt>
<dd>
<p>Enables or disables the recording function.
Information is only written to a file generation by specifying
<code>enable</code>; output is prevented by specifying <code>disable</code>.</p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>
</div>



]]></content>
  </entry>
  
</feed>
