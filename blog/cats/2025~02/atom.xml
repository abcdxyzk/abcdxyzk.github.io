<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: 2025~02 | kk Blog —— 通用基础]]></title>
  <link href="http://abcdxyzk.github.io/blog/cats/2025~02/atom.xml" rel="self"/>
  <link href="http://abcdxyzk.github.io/"/>
  <updated>2025-07-21T17:22:06+08:00</updated>
  <id>http://abcdxyzk.github.io/</id>
  <author>
    <name><![CDATA[kk]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[php获取客户端真实IP]]></title>
    <link href="http://abcdxyzk.github.io/blog/2025/02/28/lang-php-real-ip/"/>
    <updated>2025-02-28T16:16:00+08:00</updated>
    <id>http://abcdxyzk.github.io/blog/2025/02/28/lang-php-real-ip</id>
    <content type="html"><![CDATA[<p><a href="https://blog.csdn.net/ammu402004/article/details/101494775">https://blog.csdn.net/ammu402004/article/details/101494775</a></p>

<p>apache 日志默认情况下log日志格式为：
<code>
    LogFormat "%h %l %u %t \"%r\" %&gt;s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
</code>
其中%h 是记录访问者的IP，如果在web的前端有一层代理，那么这个%h其实就是代理机器的IP，这不是我们想要的。在这种情况下，</p>

<p><code>%{X-FORWARDED-FOR}i</code>  字段会记录客户端真实的IP。所以log日志改为：
<code>
    LogFormat "%h %{X-FORWARDED-FOR}i %l %u %t \"%r\" %&gt;s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
</code></p>

<hr />

<p><a href="https://www.php.cn/faq/48483.html">https://www.php.cn/faq/48483.html</a></p>

<p>php中http_x_forwarded_for 和 remote_addr的使用</p>

<p>1.REMOTE_ADDR:浏览当前页面的用户计算机的ip地址</p>

<p>2.HTTP_X_FORWARDED_FOR: 浏览当前页面的用户计算机的网关</p>

<p>3.HTTP_CLIENT_IP:客户端的ip</p>

<p>在PHP 中使用 <code>$_SERVER["REMOTE_ADDR"]</code> 来取得客户端的 IP 地址，但如果客户端是使用代理服务器来访问，那取到的就是代理服务器的 IP 地址，而不是真正的客户端 IP 地址。要想透过代理服务器取得客户端的真实 IP 地址，就要使用 <code>$_SERVER["HTTP_X_FORWARDED_FOR"]</code> 来读取。</p>

<p>不过要注意的事，并不是每个代理服务器都能用 <code>$_SERVER["HTTP_X_FORWARDED_FOR"]</code> 来读取客户端的真实 IP，有些用此方法读取到的仍然是代理服务器的 IP。</p>

<p>还有一点需要注意的是：如果客户端没有通过代理服务器来访问，那么用 <code>$_SERVER["HTTP_X_FORWARDED_FOR"]</code> 取到的值将是空的。</p>

<pre><code>    if ($_SERVER['HTTP_X_FORWARDED_FOR'] &amp;&amp; preg_match('/^([0-9]{1,3}.){3}[0-9]{1,3}$/',$_SERVER['HTTP_X_FORWARDED_FOR'])) {  
        $onlineip = $_SERVER['HTTP_X_FORWARDED_FOR'];  
    } elseif  ($_SERVER['HTTP_CLIENT_IP']  &amp;&amp; preg_match('/^([0-9]{1,3}.){3}[0-9]{1,3}$/',$_SERVER['HTTP_CLIENT_IP'])) {  
        $onlineip = $_SERVER['HTTP_CLIENT_IP']; 
    }
</code></pre>

<p>获取用户IP地址的三个属性的区别 (HTTP_X_FORWARDED_FOR,HTTP_VIA,REMOTE_ADDR)</p>

<h4>一、没有使用代理服务 器的情况：</h4>

<p>REMOTE_ADDR = 您的 IP</p>

<p>HTTP_VIA = 没数值或不显示</p>

<p>HTTP_X_FORWARDED_FOR = 没数值或不显示</p>

<h4>二、使用透明代理服务器的情 况：Transparent Proxies</h4>

<p>REMOTE_ADDR = 最后一个代理服务器 IP</p>

<p>HTTP_VIA = 代理服务器 IP</p>

<p>HTTP_X_FORWARDED_FOR = 您的真实 IP ，经过多个代理服务器时，这个值类似如下：203.98.182.163, 203.98.182.163, 203.129.72.215。</p>

<p>这类代理服务器还是将您的信息转发给您的访问对象，无法达到隐藏真实身份的目的。</p>

<h4>三、使用普通匿名代理服务器的情况：Anonymous Proxies</h4>

<p>REMOTE_ADDR = 最后一个代理服务器 IP</p>

<p>HTTP_VIA = 代理服务器 IP</p>

<p>HTTP_X_FORWARDED_FOR = 代理服务器 IP ，经过多个代理服务器时，这个值类似如下：203.98.182.163, 203.98.182.163, 203.129.72.215。</p>

<p>隐藏了您的真实IP，但是向访问对象透露了您是使用代理服务器访问他们的。</p>

<h4>四、使用欺骗性代理服务器的情况：Distorting Proxies</h4>

<p>REMOTE_ADDR = 代理服务器 IP</p>

<p>HTTP_VIA = 代理服务器 IP</p>

<p>HTTP_X_FORWARDED_FOR = 随机的 IP ，经过多个代理服务器时，这个值类似如下：203.98.182.163, 203.98.182.163, 203.129.72.215。</p>

<p>告诉了访问对象您使用了代理服务器，但编造了一个虚假的随机IP代替您的真实IP欺骗它。</p>

<h4>五、使用高匿名代理服务器的情况：High Anonymity Proxies (Elite proxies)</h4>

<p>REMOTE_ADDR = 代理服务器 IP</p>

<p>HTTP_VIA = 没数值或不显示</p>

<p>HTTP_X_FORWARDED_FOR = 没数值或不显示 ，经过多个代理服务器时，这个值类似如下：203.98.182.163, 203.98.182.163, 203.129.72.215。</p>

<p>完全用代理服务器的信息替代了您的所有信息，就象您就是完全使用那台代理服务器直接访问对象</p>
]]></content>
  </entry>
  
</feed>
